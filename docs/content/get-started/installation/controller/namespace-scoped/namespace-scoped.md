---
title: Namespace scoped Installation
description: Install Aperture Controller using namespace scoped resources
keywords:
  - install
  - setup
  - controller
  - operator
sidebar_position: 2
---

```mdx-code-block
import CodeBlock from '@theme/CodeBlock';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import {apertureVersion, apertureVersionWithOutV} from '../../../../apertureVersion.js';
```

Aperture Controller can be installed in a single namespace without any cluster
level resources.

## Prerequisites

1. Prepare a `values.yaml` file which switches the Aperture Controller to
   namespace scoped:

   ```yaml
   controller:
     namespaceScoped: true
   ```

2. If you want to install the Aperture Controller using `Helm` or don't want to
   use the certificates generated by `aperturectl`, you have to create a Secret
   containing the server SSL/TLS certificate and key for the Aperture
   Controller.

   Add the name of the Secret in the `values.yaml`:

   ```yaml
   controller:
     namespaceScoped: true
     serverCert:
       secretName: SECRET_NAME_HERE
       certFileName: "CERTIFICATE_FILENAME_HERE"
       keyFileName: "KEY_FILENAME_HERE"
   ```

## Installation {#controller-installation}

By following these instructions, you will have deployed the Aperture Controller
into your cluster.

1. Run the following `install` command with the `values.yaml` file prepared
   above:

   <Tabs groupId="setup" queryString>
   <TabItem value="aperturectl" label="aperturectl">

   If you want to use the Self-signed certificates generated by `aperturectl`,
   run the below command:

   <CodeBlock language="bash">
   {`aperturectl install controller --version ${apertureVersion} --generate-cert --values-file values.yaml`}
   </CodeBlock>

   If you want to use your own certificates, run the below command:

   <CodeBlock language="bash">
   {`aperturectl install controller --version ${apertureVersion} --values-file values.yaml`}
   </CodeBlock>

   </TabItem>
   <TabItem value="Helm" label="Helm">
   <CodeBlock language="bash">
   {`helm install controller aperture/aperture-controller -f values.yaml --skip-crds`}
   </CodeBlock>
   </TabItem>
   </Tabs>

2. By default, Prometheus and etcd instances are installed. If you do not want
   to install and use your existing instances of Prometheus or etcd, configure
   the following values in the `values.yaml` file and pass it with the `install`
   command:

   ```yaml
   controller:
     namespaceScoped: true
     config:
       etcd:
         endpoints: ["ETCD_ENDPOINT_HERE"]
       prometheus:
         address: "PROMETHEUS_ADDRESS_HERE"
   etcd:
     enabled: false

   prometheus:
     enabled: false
   ```

   Replace the values of `ETCD_ENDPOINT_HERE` and `PROMETHEUS_ADDRESS_HERE` with
   the actual values of etcd and Prometheus, which will be used by the Aperture
   Controller.

   <Tabs groupId="setup" queryString>
   <TabItem value="aperturectl" label="aperturectl">
   <CodeBlock language="bash">
   {`aperturectl install controller --version ${apertureVersion} --values-file values.yaml --generate-cert`}
   </CodeBlock>
   </TabItem>
   <TabItem value="Helm" label="Helm">
   <CodeBlock language="bash">
   {`helm install controller aperture/aperture-controller -f values.yaml --skip-crds`}
   </CodeBlock>
   </TabItem>
   </Tabs>

   A list of all the configurable parameters for etcd are available
   [here](/reference/configuration/controller.md#etcd) and Prometheus are
   available [here](/reference/configuration/controller.md#prometheus).

   **Note**: Please ensure that the flag `web.enable-remote-write-receiver` is
   enabled on your existing Prometheus instance, as it is required by the
   Aperture Controller.

3. If you want to modify the default parameters or the Aperture Controller
   configuration, for example `log`, you can update the `values.yaml` file and
   pass it with `install` command:

   ```yaml
   controller:
     namespaceScoped: true
     config:
       log:
         level: debug
         pretty_console: true
         non_blocking: false
   ```

   <Tabs groupId="setup" queryString>
   <TabItem value="aperturectl" label="aperturectl">
   <CodeBlock language="bash">
   {`aperturectl install controller --version ${apertureVersion} --values-file values.yaml --generate-cert`}
   </CodeBlock>
   </TabItem>
   <TabItem value="Helm" label="Helm">
   <CodeBlock language="bash">
   {`helm install controller aperture/aperture-controller -f values.yaml --skip-crds`}
   </CodeBlock>
   </TabItem>
   </Tabs>

   All the configuration parameters for the Aperture Controller are available
   [here](/reference/configuration/controller.md).

   A list of configurable parameters for the installation can be found in the
   [README](https://artifacthub.io/packages/helm/aperture/aperture-controller#parameters).

4. If you want to deploy the Aperture Controller into a namespace other than
   `default`, use the `--namespace` flag:

   <Tabs groupId="setup" queryString>
   <TabItem value="aperturectl" label="aperturectl">
   <CodeBlock language="bash">
   {`aperturectl install controller --version ${apertureVersion} --values-file values.yaml --namespace aperture-controller --generate-cert`}
   </CodeBlock>
   </TabItem>
   <TabItem value="Helm" label="Helm">
   <CodeBlock language="bash">
   {`helm install controller aperture/aperture-controller -f values.yaml --namespace aperture-controller --create-namespace --skip-crds`}
   </CodeBlock>
   </TabItem>
   </Tabs>

## Upgrade Procedure {#controller-upgrade-procedure}

By following these instructions, you will have deployed the upgraded version of
Aperture Controller into your cluster.

1. Use the same `values.yaml` file created as part of
   [Installation Steps](#controller-installation) and pass it with below
   command:

   <Tabs groupId="setup" queryString>
   <TabItem value="aperturectl" label="aperturectl">
   <CodeBlock language="bash">
   {`aperturectl install controller --version ${apertureVersion} --values-file values.yaml --generate-cert`}
   </CodeBlock>
   </TabItem>
   <TabItem value="Helm" label="Helm">
   <CodeBlock language="bash">
   {`helm template controller aperture/aperture-controller -f values.yaml | kubectl apply -f -`}
   </CodeBlock>

   Once all the pods are in a running state after upgrade, run the below command
   to keep the Helm release updated:

   <CodeBlock language="bash">
   {`helm upgrade controller aperture/aperture-controller -f values.yaml`}
   </CodeBlock>
   </TabItem>
   </Tabs>

2. If you have deployed the Aperture Controller into a namespace other than
   `default`, use the `--namespace` flag:

   <Tabs groupId="setup" queryString>
   <TabItem value="aperturectl" label="aperturectl">
   <CodeBlock language="bash">
   {`aperturectl install controller --version ${apertureVersion} --values-file values.yaml --namespace aperture-controller --generate-cert`}
   </CodeBlock>
   </TabItem>
   <TabItem value="Helm" label="Helm">
   <CodeBlock language="bash">
   {`helm template controller aperture/aperture-controller -f values.yaml --namespace aperture-controller | kubectl apply -f -`}
   </CodeBlock>

   Once all the pods are in a running state after upgrade, run the below command
   to keep the Helm release updated:

   <CodeBlock language="bash">
   {`helm upgrade controller aperture/aperture-controller -f values.yaml --namespace aperture-controller`}
   </CodeBlock>
   </TabItem>
   </Tabs>

## Verifying the Installation

Once you have successfully deployed the resources, confirm that the Aperture
Controller is up and running:

```bash
kubectl get pod
```

You should see pods for Aperture Controller in `RUNNING` state.

## Uninstall

You can uninstall the Aperture Controller and its components installed above, by
following the below steps.

Use the same `values.yaml` file created as part of
[Installation Steps](#controller-installation) and pass it with below command.

1. Uninstall the Aperture Controller:

   <Tabs groupId="setup" queryString>
   <TabItem value="aperturectl" label="aperturectl">
   <CodeBlock language="bash">
   {`aperturectl uninstall controller --values-file values.yaml`}
   </CodeBlock>
   </TabItem>
   <TabItem value="Helm" label="Helm">
   <CodeBlock language="bash">
   {`helm uninstall controller -f values.yaml`}
   </CodeBlock>
   </TabItem>
   </Tabs>

2. If you have installed the chart in some other namespace than `default`,
   execute the below commands:

   <Tabs groupId="setup" queryString>
   <TabItem value="aperturectl" label="aperturectl">
   <CodeBlock language="bash">
   {`aperturectl uninstall controller --namespace aperture-controller --values-file values.yaml`}
   </CodeBlock>
   </TabItem>
   <TabItem value="Helm" label="Helm">
   <CodeBlock language="bash">
   {`helm uninstall controller --namespace aperture-controller -f values.yaml`}
   </CodeBlock>
   </TabItem>
   </Tabs>

3. By default, the Secret and ConfigMap generated by the `aperturectl` for
   certificates of the Aperture Controller is not deleted with above steps. If
   you want to delete them, run the below commands:

   ```bash
   kubectl delete secret -l app.kubernetes.io/instance=controller-aperture-controller
   kubectl delete configmap -l app.kubernetes.io/instance=controller-aperture-controller
   ```
