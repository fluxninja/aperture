---
title: Infra Meter
sidebar_position: 5
keywords:
  - telemetry
  - monitoring
  - observability
  - agent
  - OpenTelemetry
---

:::info See also

- [_Infra Meter_ reference][reference]
- [Metrics integration][integration].

:::

Telemetry is central to closed loop policies in Aperture. Whereas
[_Flux Meters_](/concepts/advanced/flux-meter.md) provide precision telemetry
based on traffic flows, _Infra Meters_ provide telemetry from popular technology
components such as databases, caches, and orchestrators that make up an
application's underlying infrastructure. Several policies such as auto-scale,
service protection and feature rollout can provide more accurate control using
health and saturation telemetry collected from the infrastructure.

The Aperture Agent process has a built-in
[OpenTelemetry Collector](https://github.com/open-telemetry/opentelemetry-collector),
which allows defining collection pipelines to gather metrics from [various
sources][integration]. The _Infra Meter_ is a type of policy resource that
facilitates the setup of OpenTelemetry pipelines at Aperture Agents. It
primarily defines receivers, processors, and a single metrics pipeline. The
metrics pipeline data is exported to the Prometheus instance configured in
Aperture Controller.

## Configuration

The _Infra Meter_ resource consists of the following key parameters:

### Agent Group

The pipeline defined in the _Infra Meter_ is applied to all Agents in the
specified agent group.

### Per Agent Group

The `per_agent_group` field is used to mark the pipeline to be instantiated only
once per agent group. This is particularly useful for receivers that scrape some
cluster-wide metrics. If this field is not set, the pipeline will be
instantiated on every agent.

### Pipeline

The `pipeline` represents an OpenTelemetry (OTel) metrics pipeline definition.
This pipeline only uses receivers and processors that are defined above. The
exporter is added automatically.

In scenarios where no processors are defined, or only one processor is defined,
the pipeline definition can be omitted. Under these circumstances, the pipeline
will automatically use all given receivers and the defined processor (if any).
However, for more than one processor, the pipeline must be defined explicitly.

### Processors

The `processors` field is used to define the processors to be used in custom
metrics pipelines. The format of these processors should follow the
OpenTelemetry (OTel) format.

### Receivers

The `receivers` are defined to be used in custom metrics pipelines. The format
of these receivers should follow the OpenTelemetry (OTel) format.

:::info

For examples of configuration and instructions on how to template using
environment variables and ConfigMap, refer to the [Metrics integration
documentation][integration].

:::

## Usage

[_PromQL_][promql] components can refer to the metrics generated by the _Infra
Meter_. The name of the metric(s) depends on the receivers. In addition, the
processor can enrich the metric(s) with additional labels. The following labels
are present by default on metrics collected by an _Infra Meter_:

1. `infra_meter_name`: Name of the _Infra Meter_ in the resources section
2. `policy_name`: Name of the policy that generated the metric
3. Other common labels available at all Agents, such as `instance`.

[reference]: /reference/configuration/spec.md#infra-meter
[promql]: /reference/configuration/spec.md#prom-q-l
[integration]: /aperture-for-infra/integrations/metrics/metrics.md
