# yaml-language-server: $schema=../../../../../../blueprints/policies/service-protection/average-latency/gen/definitions.json
# Generated values file for policies/service-protection/average-latency blueprint
# Documentation/Reference for objects and parameters can be found at:
# https://docs.fluxninja.com/reference/policies/bundled-blueprints/policies/service-protection/average-latency

common:
  # Name of the policy.
  # Type: string
  # Required: True
  policy_name: workload-prioritization
policy:
  # List of additional circuit components.
  # Type: []aperture.spec.v1.Component
  components: []
  # Additional resources.
  # Type: aperture.spec.v1.Resources
  resources:
    flow_control:
      classifiers:
        - selectors:
            - service: service1-demo-app.demoapp.svc.cluster.local
              control_point: ingress
          rules:
            user_type:
              extractor:
                from: request.http.headers.user-type
  # The interval between successive evaluations of the Circuit.
  # Type: string
  evaluation_interval: "1s"
  service_protection_core:
    adaptive_load_scheduler:
      load_scheduler:
        # The selectors determine the flows that are protected by this policy.
        # Type: []aperture.spec.v1.Selector
        # Required: True
        selectors:
          - control_point: ingress
            service: service1-demo-app.demoapp.svc.cluster.local
        # Scheduler parameters.
        # Type: aperture.spec.v1.SchedulerParameters
        scheduler:
          workloads:
            - label_matcher:
                match_labels:
                  user_type: "guest"
              parameters:
                priority: 50
            - label_matcher:
                match_labels:
                  http.request.header.user_type: subscriber
              parameters:
                priority: 200
  latency_baseliner:
    # Flux Meter defines the scope of latency measurements.
    # Type: aperture.spec.v1.FluxMeter
    # Required: True
    flux_meter:
      selectors:
        - service: service1-demo-app.demoapp.svc.cluster.local
          control_point: ingress
