apiVersion: v1
kind: ConfigMap
metadata:
  name: classification
  namespace: aperture-system
  labels:
    fluxninja.com/validate: "true"
data:
  default.classification.yaml: |
    # Example of Flow Classification rules file, showcasing using "extractors" and raw rego.
    selector:
      service: demo1-demo-app.demoapp.svc.cluster.local
      control_point: { traffic: ingress }
    rules:
      # An example rule using extractor.
      # See following RFC for list of available extractors and their syntax.
      ua:
        extractor:
          from: request.http.headers.user-agent
      # The same rule using raw rego. Requires specifying rego source code and a query
      also-ua:
        rego:
          source: |
            package my.rego.pkg
            import input.attributes.request.http
            ua = http.headers["user-agent"]
          query: data.my.rego.pkg.ua
      user-type:
        extractor:
          from: request.http.headers.user-type
