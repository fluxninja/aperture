{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "policies/feature-rollout/percentile-latency blueprint",
  "additionalProperties": false,
  "required": ["common", "policy"],
  "properties": {
    "common": {
      "type": "object",
      "additionalProperties": false,
      "required": ["policy_name"],
      "properties": {
        "policy_name": {
          "description": "Name of the policy.",
          "default": "__REQUIRED_FIELD__",
          "type": "string"
        }
      }
    },
    "policy": {
      "description": "Parameters for the Feature Rollout policy.",
      "default": {
        "components": [],
        "drivers": {
          "percentile_latency_drivers": [
            {
              "criteria": {
                "backward": {
                  "threshold": "__REQUIRED_FIELD__"
                },
                "forward": {
                  "threshold": "__REQUIRED_FIELD__"
                },
                "reset": {
                  "threshold": "__REQUIRED_FIELD__"
                }
              },
              "flux_meter": {
                "flow_selector": {
                  "flow_matcher": {
                    "control_point": "__REQUIRED_FIELD__"
                  },
                  "service_selector": {
                    "service": "__REQUIRED_FIELD__"
                  }
                },
                "static_buckets": {
                  "buckets": [
                    5, 10, 25, 50, 100, 250, 500, 1000, 2500, 5000, 10000
                  ]
                }
              },
              "percentile": 95
            }
          ]
        },
        "evaluation_interval": "1s",
        "load_ramp": {
          "regulator_parameters": {
            "flow_selector": {
              "flow_matcher": {
                "control_point": "__REQUIRED_FIELD__"
              },
              "service_selector": {
                "service": "__REQUIRED_FIELD__"
              }
            },
            "label_key": ""
          },
          "steps": [
            {
              "duration": "__REQUIRED_FIELD__",
              "target_accept_percentage": "__REQUIRED_FIELD__"
            }
          ]
        },
        "resources": {
          "flow_control": {
            "classifiers": []
          }
        }
      },
      "type": "object",
      "$ref": "../../../../policies/feature-rollout/base/gen/definitions.json#/$defs/rollout_policy"
    },
    "dashboard": {
      "description": "Configuration for the Grafana dashboard accompanying this policy.",
      "default": {
        "datasource": {
          "filter_regex": "",
          "name": "$datasource"
        },
        "refresh_interval": "5s",
        "time_from": "now-15m",
        "time_to": "now"
      },
      "type": "object",
      "$ref": "../../../../policies/feature-rollout/base/gen/definitions.json#/properties/dashboard"
    }
  },
  "$defs": null
}
