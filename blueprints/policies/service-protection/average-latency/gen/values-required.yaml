# Generated values file for policies/service-protection/average-latency blueprint
# Documentation/Reference for objects and parameters can be found at:
# https://docs.fluxninja.com/reference/policies/bundled-blueprints/policies/service-protection/average-latency

common:
  # Name of the policy.
  # Type: string
  # Required: True
  policy_name: __REQUIRED_FIELD__

policy:
  service_protection_core:
    # Parameters for Adaptive Load Scheduler.
    # Type: aperture.spec.v1.AdaptiveLoadSchedulerParameters
    # Required: True
    adaptive_load_scheduler:
      alerter:
        alert_name: "Load Throttling Event"
      gradient:
        max_gradient: 1
        min_gradient: 0.1
        slope: -1
      load_multiplier_linear_increment: 0.0025
      load_scheduler:
        selectors:
          - control_point: __REQUIRED_FIELD__
            service: __REQUIRED_FIELD__
      max_load_multiplier: 2
  latency_baseliner:
    # Flux Meter defines the scope of latency measurements.
    # Type: aperture.spec.v1.FluxMeter
    # Required: True
    flux_meter:
      selectors:
        - control_point: __REQUIRED_FIELD__
          service: __REQUIRED_FIELD__
    # EMA parameters.
    # Type: aperture.spec.v1.EMAParameters
    ema:
      correction_factor_on_max_envelope_violation: 0.95
      ema_window: "1500s"
      warmup_window: "60s"
    # Tolerance factor beyond which the service is considered to be in overloaded state. E.g. if EMA of latency is 50ms and if Tolerance is 1.1, then service is considered to be in overloaded state if current latency is more than 55ms.
    # Type: float64
    latency_tolerance_multiplier: 1.1
    # Current latency value is multiplied with this factor to calculate maximum envelope of Latency EMA.
    # Type: float64
    latency_ema_limit_multiplier: 2
