server:
  addr: ":{{ .Values.agentController.serverPort }}"

otel:
  addr: ":{{ .Values.agentController.serverPort }}"

webhooks:
  addr: ":8086"
  tls:
    enable: true
    certs_path: "/etc/aperture/aperture-agent/certs"
    server_cert: "crt.pem"
    server_key: "key.pem"

log:
  pretty_console: {{ .Values.agentController.log.prettyConsole }}
  non_blocking: {{ .Values.agentController.log.nonBlocking }}
  level: "{{ .Values.agentController.log.level }}"
  file: "{{ .Values.agentController.log.file }}"

etcd:
  endpoints: {{ include "aperture.etcd.endpoints" (dict "etcd" .Values.etcd "context" . $) }}
  lease_ttl: {{ .Values.etcd.leaseTtl }}

prometheus:
  address: {{ include "aperture.prometheus.address" (dict "prometheus" .Values.prometheus "context" . $) | quote }}

plugins:
  disable_plugins: false
  {{- if not .Values.fluxninjaPlugin.enabled }}
  disabled_plugins:
    - aperture-plugin-fluxninja
  {{- end }}

{{- if .Values.fluxninjaPlugin.enabled }}
fluxninja_plugin:
  fluxninja_endpoint: "{{ .Values.fluxninjaPlugin.endpoint }}"
  heartbeat_interval: "{{ .Values.fluxninjaPlugin.heartbeatsInterval }}"
  client_grpc:
    insecure: {{ .Values.fluxninjaPlugin.tls.insecure | default false }}
    tls:
      insecure_skip_verify: {{ .Values.fluxninjaPlugin.tls.insecureSkipVerify | default false }}
      ca_file: {{ .Values.fluxninjaPlugin.tls.caFile | default "" }}
  client_http:
    tls:
      insecure_skip_verify: {{ .Values.fluxninjaPlugin.tls.insecureSkipVerify | default false }}
      ca_file: {{ .Values.fluxninjaPlugin.tls.caFile | default "" }}
{{- end }}
